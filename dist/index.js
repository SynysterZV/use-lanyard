"use strict";var y=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var A=Object.prototype.hasOwnProperty;var T=(t,n)=>{for(var r in n)y(t,r,{get:n[r],enumerable:!0})},k=(t,n,r,s)=>{if(n&&typeof n=="object"||typeof n=="function")for(let e of D(n))!A.call(t,e)&&e!==r&&y(t,e,{get:()=>n[e],enumerable:!(s=v(n,e))||s.enumerable});return t};var P=t=>k(y({},"__esModule",{value:!0}),t);var O={};T(O,{DEFAULT_OPTIONS:()=>m,LanyardError:()=>b,SocketEvents:()=>L,SocketOpcode:()=>w,get:()=>S,getURL:()=>_,useLanyard:()=>R,useLanyardWS:()=>h});module.exports=P(O);var p=require("react");var g=require("react");function E(){return(0,g.useContext)(I)}var I=(0,g.createContext)({listeners:new Set,stateMap:new Map});var m={api:{hostname:"api.lanyard.rest",secure:!0}};function _(t,n){return`${n.api.secure?"https":"http"}://${n.api.hostname}/v1/users/${t}`}async function S(t,n){let r={method:"GET",signal:n.controller?.signal??null,headers:{Accept:"application/json"}},s=new Request(t,r),e=await fetch(s),c=await e.json();return c.success?{success:!0,data:c.data}:{success:!1,error:new b(s,e,c)}}var b=class extends Error{constructor(r,s,e){super(e.error.message);this.request=r;this.response=s;this.body=e;this.code=this.response.status}code};function R(t,n){let r={...m,...n},[,s]=(0,p.useState)({}),e=E();e.stateMap.has(t)||e.stateMap.set(t,{state:"initial",isLoading:!1,data:r.initialData,error:void 0});let c=o=>{e.stateMap.set(t,o);for(let i of e.listeners)i()},l=()=>{let o=e.stateMap.get(t);if(!o)throw new Error("State not found");return o},u=o=>{c({...l(),isLoading:o})},d=_(t,r),a=(0,p.useCallback)(async o=>{if(l().isLoading)return;u(!0);let i=await S(d,o?{...r,controller:o}:r);i.error?c({...l(),state:"errored",error:i.error,isLoading:!1}):c({...l(),state:"loaded",data:i.data,isLoading:!1})},[d]);return(0,p.useEffect)(()=>{let o=()=>s({});e.listeners.add(o);let i=new AbortController;return a().finally(()=>{u(!1)}),()=>{i.abort(),e.listeners.delete(o)}},[a]),{...l(),revalidate:(0,p.useCallback)(()=>a(),[a])}}var x=require("react");var w=(e=>(e[e.Event=0]="Event",e[e.Hello=1]="Hello",e[e.Initialize=2]="Initialize",e[e.Heartbeat=3]="Heartbeat",e))(w||{}),L=(r=>(r.INIT_STATE="INIT_STATE",r.PRESENCE_UPDATE="PRESENCE_UPDATE",r))(L||{});function h(t,n){let r={...m,...n},[s,e]=(0,x.useState)(),l=`${r.api.secure?"wss":"ws"}://${r.api.hostname}/socket`;return(0,x.useEffect)(()=>{if(typeof window>"u")return;if(!("WebSocket"in window||"MozWebSocket"in window))throw new Error("WebSocket connections not supported in this browser.");let u;typeof t=="object"?u={subscribe_to_ids:t}:u={subscribe_to_id:t};let d,a;function o(){d&&clearInterval(d),a=new WebSocket(l),a.addEventListener("open",()=>{console.log("Lanyard: Socket connection opened")}),a.addEventListener("close",o),a.addEventListener("message",i=>{let f=JSON.parse(i.data);switch(f.op){case 1:{d=setInterval(()=>{a.readyState===a.OPEN&&a.send(JSON.stringify({op:3}))},f.d?.heartbeat_interval),a.readyState===a.OPEN&&a.send(JSON.stringify({op:2,d:u}));break}case 0:{switch(f.t){case"INIT_STATE":case"PRESENCE_UPDATE":{f.d&&e(f.d);break}default:break}break}default:break}})}return o(),()=>{clearInterval(d),a.removeEventListener("close",o),a.close()}},[l]),s??r.initialData}0&&(module.exports={DEFAULT_OPTIONS,LanyardError,SocketEvents,SocketOpcode,get,getURL,useLanyard,useLanyardWS});
//# sourceMappingURL=index.js.map